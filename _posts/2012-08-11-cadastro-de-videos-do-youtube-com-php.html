---
layout: post
status: publish
published: true
title: Cadastro de V&iacute;deos do YouTube com PHP
author:
  display_name: Glauco Cust√≥dio
  login: glauco-custodio
  email: glauco.custodio@gmail.com
  url: http://glaucocustodio.com
author_login: glauco-custodio
author_email: glauco.custodio@gmail.com
author_url: http://glaucocustodio.com
excerpt: "Fala pessoal, beleza? Voc&ecirc;s j&aacute; precisaram incluir um v&iacute;deo
  do <strong>YouTube<&#47;strong> de forma din&acirc;mica em algum site? Sim? Ent&atilde;o
  esse post &eacute; para voc&ecirc;s.\r\n\r\nHoje irei explicar como fazer um cadastro
  de v&iacute;deos do YouTube com PHP de forma simples e r&aacute;pida.. Vamos ao
  tutorial!\r\n\r\n<a href=\"http:&#47;&#47;blog.glaucocustodio.com&#47;2012&#47;08&#47;11&#47;cadastro-de-videos-do-youtube-com-php&#47;\"><img
  class=\"alignnone  wp-image-274\" title=\"Cadastro de V&iacute;deo do YouTube com
  PHP\" src=\"http:&#47;&#47;blog.glaucocustodio.com&#47;wp-content&#47;uploads&#47;2012&#47;08&#47;saving-youtube-videos-with-php.jpg\"
  alt=\"\" width=\"580\" height=\"240\" &#47;><&#47;a>\r\n\r\n"
wordpress_id: 270
wordpress_url: http://blog.glaucocustodio.com/?p=270
date: '2012-08-11 03:42:26 -0300'
date_gmt: '2012-08-11 03:42:26 -0300'
categories:
- PHP
tags:
- php
comments:
- id: 312
  author: Lucas Freitas
  author_email: lucas@lucasfreitas.com.br
  author_url: http://www.agencianeo.com
  date: '2013-01-18 21:11:04 -0200'
  date_gmt: '2013-01-18 21:11:04 -0200'
  content: Eu achei que o post falaria sobre o envio de arquivos para o YouTube, n&atilde;o
    um simples cadastro de v&iacute;deos que j&aacute; est&atilde;o l&aacute;...
- id: 586
  author: cheap authentic jordans
  author_email: wuyrdfunvs@gmail.com
  author_url: http://cheapauthenticretrojordans.me.cc
  date: '2013-05-09 21:34:42 -0300'
  date_gmt: '2013-05-09 21:34:42 -0300'
  content: Cadastro de V&iacute;deos do YouTube com PHP | JustCode [url=http:&#47;&#47;cheapauthenticretrojordans.me.cc]cheap
    authentic jordans[&#47;url]
- id: 609
  author: Edson
  author_email: stevl@bol.com.br
  author_url: http://www.brazildetectors.com
  date: '2013-05-17 18:42:06 -0300'
  date_gmt: '2013-05-17 18:42:06 -0300'
  content: Era o que eu procurava, vlw por compartilhar seu conhecimento
- id: 763
  author: marcos
  author_email: marcosbrinner2@uol.com.br
  author_url: http://www.fottic.com
  date: '2013-06-24 04:35:40 -0300'
  date_gmt: '2013-06-24 04:35:40 -0300'
  content: ai cara pelo amor de deus kkk esse turorilixo para salvar um link do  youtube
    era mais facil  usar api  que pega a thumbnail descri&ccedil;&atilde;o e titulo
    do video
- id: 2208
  author: Amanda
  author_email: amandapistolato@hotmail.com.br
  author_url: ''
  date: '2014-05-04 15:26:26 -0300'
  date_gmt: '2014-05-04 15:26:26 -0300'
  content: Excelente!! Sou iniciante e essa p&aacute;gina me ajudou muito porque explica
    todos os detalhes.
- id: 2439
  author: thayna jacot varela
  author_email: thaynajacotvarela@gmail.com
  author_url: http://finimeno
  date: '2014-06-10 14:42:50 -0300'
  date_gmt: '2014-06-10 14:42:50 -0300'
  content: juoz
- id: 17492
  author: sNniffer
  author_email: leonidaswander@gmail.com
  author_url: ''
  date: '2014-12-06 14:09:28 -0200'
  date_gmt: '2014-12-06 14:09:28 -0200'
  content: Muito bom mesmo
- id: 22510
  author: Neto San
  author_email: sanec@hotmail.com.br
  author_url: ''
  date: '2015-02-20 05:33:20 -0200'
  date_gmt: '2015-02-20 05:33:20 -0200'
  content: "Muito bom, estava a procura, falow\r\nObrigado"
- id: 35339
  author: joao neto
  author_email: djnetinho26@hotmail.com
  author_url: http://yuotube
  date: '2015-07-06 21:26:40 -0300'
  date_gmt: '2015-07-06 21:26:40 -0300'
  content: Legau
---
<p>Fala pessoal, beleza? Voc&ecirc;s j&aacute; precisaram incluir um v&iacute;deo do <strong>YouTube<&#47;strong> de forma din&acirc;mica em algum site? Sim? Ent&atilde;o esse post &eacute; para voc&ecirc;s.</p>
<p>Hoje irei explicar como fazer um cadastro de v&iacute;deos do YouTube com PHP de forma simples e r&aacute;pida.. Vamos ao tutorial!</p>
<p><a href="http:&#47;&#47;blog.glaucocustodio.com&#47;2012&#47;08&#47;11&#47;cadastro-de-videos-do-youtube-com-php&#47;"><img class="alignnone  wp-image-274" title="Cadastro de V&iacute;deo do YouTube com PHP" src="http:&#47;&#47;blog.glaucocustodio.com&#47;wp-content&#47;uploads&#47;2012&#47;08&#47;saving-youtube-videos-with-php.jpg" alt="" width="580" height="240" &#47;><&#47;a></p>
<p><a id="more"></a><a id="more-270"></a>Primeiro vamos criar a tabela <code>videos<&#47;code> respons&aacute;vel por armazenar os dados, segue o SQL abaixo.</p>
<p>[code language="sql" linenos="1"]<br />
CREATE TABLE `videos` (<br />
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,<br />
  `title` varchar(255) DEFAULT NULL,<br />
  `video_id` varchar(20) DEFAULT NULL,<br />
  PRIMARY KEY (`id`)<br />
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=latin1;<br />
[&#47;code]</p>
<p>Feito isso, vamos criar um formul&aacute;rio para cadastro dos v&iacute;deos, ele ir&aacute; conter os campos <code>title<&#47;code> e <code>url<&#47;code> onde ser&atilde;o preenchidos o t&iacute;tulo e o endere&ccedil;o do v&iacute;deo no YouTube respectivamente.</p>
<p>[code language="html" linenos="1"]</p>
<form method="post" action="save.php">
     <label for="title">T&iacute;tulo:<&#47;label><br />
     <input type="text" name="title" id="title" size="40" maxlength="40"&#47;></p>
<p>     <label for="url">Endere&ccedil;o:<&#47;label><br />
     <input type="text" name="url" id="url" size="60"&#47;></p>
<p>     <input type="submit" value="Cadastrar" &#47;><br />
<&#47;form><br />
[&#47;code]</p>
<div class="note">Observe que definimos o tipo de envio do formul&aacute;rio para <code>post<&#47;code> pois n&atilde;o queremos passar os dados pela url.<&#47;div></p>
<p>Agora vamos fazer a p&aacute;gina <code>save.php<&#47;code> que conter&aacute; o c&oacute;digo respons&aacute;vel por salvar os v&iacute;deos no banco de dados.</p>
<p>[code language="php" linenos="1"]<br />
<?php<br />
&#47;&#47; Inclui arquivo de conex&atilde;o com banco de dados<br />
include_once 'database.php';</p>
<p>&#47;&#47; Verifica se o formul&aacute;rio foi submetido e se &eacute; uma requis&atilde;o do tipo POST<br />
if($_SERVER['REQUEST_METHOD'] == 'POST'){<br />
    &#47;&#47; Armazena os dados enviados em uma vari&aacute;vel<br />
    $post = $_POST;</p>
<p>    &#47;&#47; Verifica se o t&iacute;tulo (m&iacute;nimo 5 caracteres) e o endere&ccedil;o foram preenchidos<br />
    if(isset($post['title']) && $post['title'] && strlen($post['title']) >= 5 && isset($post['url']) && $post['url']){<br />
        &#47;&#47; Filtra o t&iacute;tulo (remove tags HTML)<br />
        $title = filter_var($post['title']);</p>
<p>        &#47;&#47; Analisa o endere&ccedil;o do v&iacute;deo (parse)<br />
        $subString = parse_url($post['url']);</p>
<p>        &#47;&#47; Verifica se tem o &iacute;ndice 'query' no array obtido pelo parse acima<br />
        if(isset($subString['query']) && $subString['query']){<br />
            &#47;&#47; Analisa a string de 'query' para encontrar o id do v&iacute;deo<br />
            parse_str($subString['query'], $output);</p>
<p>            &#47;&#47; Se tiver a vari&aacute;vel 'v' na url e tiver um id setado, ent&atilde;o cadastra o v&iacute;deo<br />
            if(isset($output['v']) && $output['v']){</p>
<p>                &#47;&#47; Prepara uma senten&ccedil;a para ser executada<br />
                $statement = $pdo->prepare('INSERT INTO videos (title, video_id) VALUES (:title, :video_id)');<br />
                &#47;&#47; Preenche os par&acirc;metros com os dados a serem salvos<br />
                $statement->bindParam(':title', $title);<br />
                $statement->bindParam(':video_id',   $output['v']);</p>
<p>                &#47;&#47; Cadastra o v&iacute;deo no banco de dados<br />
                if($statement->execute()){<br />
                    &#47;&#47; Definimos a mensagem de sucesso<br />
                    $_SESSION['message'] = 'V&iacute;deo cadastrado com sucesso';<br />
                }else{<br />
                    &#47;&#47; Definimos a mensagem de erro<br />
                    $_SESSION['message'] = 'Falha ao cadastrar v&iacute;deo';<br />
                } </p>
<p>            }else{<br />
                $_SESSION['message'] = 'Endere&ccedil;o do v&iacute;deo inv&aacute;lido';<br />
            }<br />
        }else{<br />
            $_SESSION['message'] = 'Endere&ccedil;o do v&iacute;deo inv&aacute;lido';<br />
        }</p>
<p>    }else{<br />
        $_SESSION['message'] = 'Preencha todos os campos (t&iacute;tulo deve ter no m&iacute;nimo 5 caracteres)';<br />
    }<br />
}<br />
&#47;&#47; Redireciona para a p&aacute;gina inicial<br />
header('Location: index.php');<br />
?><br />
[&#47;code]</p>
<p>Primeiro inclu&iacute;mos o arquivo <code>database.php<&#47;code> respons&aacute;vel por fazer a conex&atilde;o com o banco de dados via PDO (<a title="Usando PDO do PHP" href="http:&#47;&#47;blog.glaucocustodio.com&#47;2012&#47;08&#47;04&#47;usando-pdo-do-php&#47;" target="_blank">clique aqui<&#47;a> para saber mais sobre PDO), depois verificamos se o formul&aacute;rio foi submetido e se os campos est&atilde;o v&aacute;lidos. Por fim, salvamos o v&iacute;deo no banco, mas espera ai, na verdade salvamos apenas o id dele..</p>
<p>Observe que se pegarmos qualquer url de v&iacute;deo do YouTube iremos ver que ela possui um par&acirc;metro <code>v<&#47;code> com um c&oacute;digo, esse c&oacute;digo &eacute; o id do v&iacute;deo. Ex: http:&#47;&#47;www.youtube.com&#47;watch?v=yMLzB1fsSTc, id &eacute; <code>yMLzB1fsSTc<&#47;code>.</p>
<p>Como j&aacute; conhecemos o resto da url e n&atilde;o precisamos dela, ent&atilde;o salvamos s&oacute; o id do v&iacute;deo, isso tamb&eacute;m nos permite criarmos uma miniatura do v&iacute;deo na listagem.</p>
<p>Agora que j&aacute; temos o cadastro pronto, vamos para listagem dos v&iacute;deos cadastrados.</p>
<p>[code language="html+php" linenos="1" hl_lines="10"]</p>
<ul id="video-list">
        <?php foreach($pdo->query('SELECT * FROM videos ORDER BY id DESC') as $c): ?></p>
<li>
<p>
                    <strong><br />
                        <?php echo $c['title']; ?><br />
                    <&#47;strong><br />
                <&#47;p><br />
                <a title="<?php echo $c['title'] ?>" href="http:&#47;&#47;www.youtube.com&#47;embed&#47;<?php echo $c['video_id'] ?>?rel=0&amp;wmode=transparent"><br />
                    <img src="http:&#47;&#47;i1.ytimg.com&#47;vi&#47;<?php echo $c['video_id'] ?>&#47;default.jpg" alt="<?php echo $c['title']; ?>" &#47;><br />
                <&#47;a></p>
<p>                <a onclick="return confirm('Deseja mesmo excluir esse v&iacute;deo?')" href="delete.php?id=<?php echo base64_encode($c['id']); ?>">Excluir<&#47;a><br />
            <&#47;li><br />
        <?php endforeach; ?><br />
<&#47;ul><br />
[&#47;code]</p>
<div class="note">Inclu&iacute;mos a miniatura do v&iacute;deo (tag img) dentro de um link pois usamos o atributo href desse para exibir o v&iacute;deo em uma lightbox quando clicamos sobre a imagem (caso tenha d&uacute;vida recomendo que baixe o c&oacute;digo completo e veja funcionando).<&#47;div></p>
<p>Veja a linha 10, o YouTube nos fornece um endere&ccedil;o para capturarmos uma imagem de um trecho do v&iacute;deo, para isso precisamos passar apenas o id do v&iacute;deo em uma url como essa http:&#47;&#47;i1.ytimg.com&#47;vi&#47;<span style="text-decoration: underline;">yMLzB1fsSTc<&#47;span>&#47;default.jpg (id destacado) e teremos a miniatura em imagem.</p>
<p>O c&oacute;digo acima tamb&eacute;m possui um link para excluir o v&iacute;deo, ele simplesmente nos manda para a p&aacute;gina <code>delete.php<&#47;code> passando o id do registro como par&acirc;metro. Segue abaixo o c&oacute;digo respons&aacute;vel por excluir v&iacute;deos.</p>
<p>[code language="php" linenos="1"]<br />
<?php<br />
&#47;&#47; Inclui o arquivo de conex&atilde;o com banco de dados<br />
include_once 'database.php';</p>
<p>&#47;&#47; Verifica se &eacute; uma requis&atilde;o do tipo GET<br />
if($_SERVER['REQUEST_METHOD'] == 'GET'){<br />
    $get = $_GET;</p>
<p>    &#47;* Verifica se veio o id do registro pela url e se tem um valor definido<br />
     * Obs: fun&ccedil;&atilde;o base64_decode decodifica uma string, &eacute; o inverso de base64_encode usada por seguran&ccedil;a<br />
     *&#47;<br />
    if(isset($get['id']) && base64_decode($get['id'])){<br />
        &#47;&#47; Executa query respons&aacute;vel por remover o registro<br />
        $delete = $pdo->exec('DELETE FROM videos WHERE id = '. base64_decode($get['id']));</p>
<p>        &#47;&#47; Verifica se o registro foi removido com sucesso<br />
        if($delete){<br />
            &#47;&#47; Definimos a mensagem de sucesso<br />
            $_SESSION['message'] = 'V&iacute;deo excluido com sucesso';<br />
        }else{<br />
            &#47;&#47; Definimos a mensagem de erro<br />
            $_SESSION['message'] = 'Falha ao excluir v&iacute;deo';<br />
        }<br />
    }else{<br />
        &#47;&#47; Definimos a mensagem de erro<br />
        $_SESSION['message'] = 'Falha ao excluir v&iacute;deo';<br />
    }<br />
}</p>
<p>&#47;&#47; Redirecionamos para a p&aacute;gina inicial<br />
header('Location: index.php');<br />
?><br />
[&#47;code]</p>
<p>&Eacute; s&oacute; isso! Agora j&aacute; temos um cadastro de v&iacute;deos do YouTube.. Voc&ecirc;s podem conferir o c&oacute;digo desse exemplo completo em meu <a title="https:&#47;&#47;github.com&#47;glaucocustodio&#47;glauco-blog-tutorials&#47;tree&#47;master&#47;Cadastro%20de%20videos%20do%20YouTube" rel="external nofollow" href="https:&#47;&#47;github.com&#47;glaucocustodio&#47;glauco-blog-tutorials&#47;tree&#47;master&#47;Cadastro%20de%20videos%20do%20YouTube" target="_blank">GitHub<&#47;a>.</p>
<p>O que voc&ecirc;s acharam, simples n&atilde;o?</p>
<p>At&eacute; mais.</p>
