---
layout: post
status: publish
published: true
title: Auto Orienting Images with Paperclip
author:
  display_name: Glauco Cust√≥dio
  login: glauco-custodio
  email: glauco.custodio@gmail.com
  url: http://glaucocustodio.com
author_login: glauco-custodio
author_email: glauco.custodio@gmail.com
author_url: http://glaucocustodio.com
wordpress_id: 3453
wordpress_url: http://blog.glaucocustodio.com/?p=3453
date: '2015-08-04 19:52:04 -0300'
date_gmt: '2015-08-04 19:52:04 -0300'
categories:
- Ruby
tags:
- paperclip
comments: []
---
<p>Hi folks, have you ever had some issue with image's orientation while performing uploads with <a href="https:&#47;&#47;github.com&#47;thoughtbot&#47;paperclip" target="_blank" rel="external nofollow">Paperclip<&#47;a> gem?</p>
<p>This week after taking some photos with an iPad app and uploading them to my Rails site I realized that something wasn't good.</p>
<p>The photos were taken in vertical orientation, however, they were being displayed in horizontal in my site.</p>
<p>Looking into thumbnails generated by Paperclip I saw they were in the correct orientation. Just the original ones were wrong.</p>
<p>I found out that there are an <a href="http:&#47;&#47;www.imagemagick.org&#47;script&#47;command-line-options.php#auto-orient" target="_blank" rel="external nofollow">ImageMagick's option<&#47;a> called <code>auto-orient<&#47;code> which enables us to correct the orientation.</p>
<p>Paperclip give us a way to pass command line options to ImageMagick like below:<br />
[code language="ruby"]<br />
has_attached_file :logo, styles: { original: {convert_options: '-auto-orient'} }<br />
[&#47;code]</p>
<p>How I would need to repeat this code in some models, I chose to place it in my <code>config&#47;initializers&#47;paperclip.rb<&#47;code> file together with others already existing default options:</p>
<p>[code language="ruby"]<br />
# ...<br />
Paperclip::Attachment.default_options[:storage]         = :s3<br />
Paperclip::Attachment.default_options[:s3_credentials]  = "#{Rails.root}&#47;config&#47;s3.yml"<br />
Paperclip::Attachment.default_options[:styles]          = lambda { |attachment|<br />
  attachment.content_type.index("image&#47;") == 0 ? {original: {convert_options: "-auto-orient"}} : {}<br />
}<br />
[&#47;code]</p>
<p>But wait! Look that we are doing some checking before adding this options, it is required to avoid problems while trying to auto orient files that aren't images (like pdf).</p>
<p>I hope it help.</p>
<p>See you.</p>
