---
layout: post
status: publish
published: true
title: Auto Orienting Images with Paperclip
author:
  display_name: Glauco Custodio
date: '2015-08-04 19:52:04 -0300'
date_gmt: '2015-08-04 19:52:04 -0300'
categories:
- Ruby
tags:
- paperclip
comments: []
---
<p>
  Hi folks, have you ever had some issue with image's orientation while performing uploads with <a href="https://github.com/thoughtbot/paperclip" target="_blank" rel="external nofollow">Paperclip</a> gem?
</p>

<p>This week after taking some photos with an iPad app and uploading them to my Rails site I realized that something wasn't good.</p>

<p>The photos were taken in the vertical orientation, however, they were being displayed in horizontal on my site.</p>

<p>Looking into thumbnails generated by Paperclip I saw they were in the correct orientation. Just the original ones were wrong.</p>

<p>I found out that there is an <a href="http://www.imagemagick.org/script/command-line-options.php#auto-orient" target="_blank" rel="external nofollow">ImageMagick's option</a> called <code>auto-orient</code> which enables us to correct the orientation.</p>

<p>Paperclip give us a way to pass command line options to ImageMagick like below:</p>
{% highlight ruby %}
has_attached_file :logo, styles: { original: {convert_options: '-auto-orient'} }
{% endhighlight %}

<p>How I would need to repeat this code in some models, I chose to place it in my <code>config/initializers/paperclip.rb</code> file together with others already existing default options:</p>

{% highlight ruby %}
# ...
Paperclip::Attachment.default_options[:storage]         = :s3
Paperclip::Attachment.default_options[:s3_credentials]  = "#{Rails.root}/config/s3.yml"
Paperclip::Attachment.default_options[:styles]          = lambda { |attachment|
  attachment.content_type.index("image/") == 0 ? {original: {convert_options: "-auto-orient"}} : {}
}
{% endhighlight %}

<p>But wait! Look that we are doing some checking before adding this options, it is required to avoid problems while trying to auto orient files that aren't images (like pdf).</p>

<p>I hope it helps.</p>

<p>See you.</p>
